# .github/workflows/deploy.yml
name: Deploy LibreChat

# This workflow runs on any push to the 'main' branch
on:
  push:
    branches: [ main ]

jobs:
  deploy:
    # Run this job on your Ubuntu server
    runs-on: self-hosted

    steps:
      # 1. Check out the new code
      - name: Check out code
        uses: actions/checkout@v4

      # 2. Create the .env file from your GitHub Secret
      - name: Create .env file
        run: echo "${{ secrets.DOT_ENV }}" > .env
        shell: bash

      # 3. Run the docker-compose deployment commands
      - name: Deploy with Docker Compose
        run: |         
          # Pull the latest versions of the images (mongo, etc)
          docker compose pull

          # Build the local images (like 'api' and 'client')
          # and re-create all containers in detached mode.
          docker compose up -d --build

          # Clean up any old, unused images
          docker image prune -f
